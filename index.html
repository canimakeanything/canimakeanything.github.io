<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner</title>
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#faf9f7">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nanum Round Gothic', -apple-system, sans-serif;
            background-color: #faf9f7;
            color: #3a3a3a;
            min-height: 100vh;
        }

        /* 페이지 전환 */
        .page {
            display: none;
            min-height: 100vh;
            flex-direction: column;
        }

        .page.active {
            display: flex;
        }

        /* 네비게이션 */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            background-color: #ffffff;
            border-bottom: 1px solid #ece9e4;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .navbar-title {
            font-size: 18px;
            font-weight: 600;
            color: #3a3a3a;
        }

        .nav-link {
            font-size: 15px;
            color: #888;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            background-color: #f0ede8;
            color: #3a3a3a;
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 4px;
        }

        .hamburger span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: #3a3a3a;
            border-radius: 2px;
        }

        /* 설정 패널 */
        .settings-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 100;
        }

        .settings-overlay.open { display: block; }

        .settings-panel {
            position: fixed;
            top: 0; right: -320px;
            width: 300px;
            height: 100%;
            background: #ffffff;
            padding: 30px 24px;
            z-index: 101;
            transition: right 0.3s ease;
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
        }

        .settings-panel.open { right: 0; }

        .settings-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 30px;
            padding-bottom: 16px;
            border-bottom: 1px solid #ece9e4;
        }

        .settings-label {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 14px;
            font-weight: 500;
        }

        .color-presets {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .color-preset {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s;
        }

        .color-preset:hover { transform: scale(1.15); }
        .color-preset.selected { border-color: #3a3a3a; transform: scale(1.15); }

        .custom-color-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .custom-color-row label { font-size: 14px; color: #888; }

        input[type="color"] {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 2px solid #ece9e4;
            cursor: pointer;
            padding: 2px;
            background: none;
        }

        /* 카드 공통 */
        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
        }

        /* 메인 영역 */
        .main {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 24px;
            max-width: 1100px;
            margin: 0 auto;
            width: 100%;
        }

        /* ============= PLAN 페이지 스타일 ============= */
        .date-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 14px;
            border-bottom: 1px solid #ece9e4;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .plan-slot {
            display: grid;
            grid-template-columns: 28px 1fr 68px;
            gap: 10px;
            align-items: center;
            padding: 11px 13px;
            background-color: #faf9f7;
            border-radius: 10px;
            border: 1px solid #ece9e4;
            transition: background-color 0.2s, opacity 0.3s;
        }

        .plan-slot:hover { background-color: #f0ede8; }
        .plan-slot.completed { opacity: 0.4; }

        .plan-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #ccc;
            cursor: pointer;
            appearance: none;
            position: relative;
            transition: all 0.2s;
            flex-shrink: 0;
            visibility: hidden;
        }

        .plan-checkbox.visible { visibility: visible; }

        .plan-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: -1px; left: 3px;
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
        }

        .slot-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 15px;
            font-family: inherit;
            color: #3a3a3a;
            outline: none;
        }

        .plan-time {
            text-align: center;
            font-size: 12px;
            padding: 5px 8px;
            border-radius: 20px;
            background-color: #ece9e4;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #3a3a3a;
            visibility: hidden;
            white-space: nowrap;
        }

        .plan-time.visible { visibility: visible; }

        .plan-time:hover {
            background-color: var(--theme, #b8d4e8);
            color: #3a3a3a;
        }

        .plan-slot.completed .plan-time {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .plan-slot.completed .plan-time:hover {
            background-color: #ece9e4;
            color: #3a3a3a;
        }

        .total-study-time {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #ece9e4;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-study-label {
            font-size: 14px;
            color: #aaa;
            font-weight: 500;
        }

        .total-study-value {
            font-size: 22px;
            font-weight: 600;
            color: #3a3a3a;
        }

        .right-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* D-day */
        .dday-card {
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dday-card:hover { background-color: #f8f8f8; }

        .dday-form {
            display: none;
            flex-direction: column;
            gap: 14px;
            width: 100%;
            padding: 10px 0;
        }

        .dday-form.visible { display: flex; }

        .dday-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 7px;
        }

        .dday-form input {
            width: 100%;
            padding: 13px 11px;
            height: 46px;
            border: 1.5px solid #ece9e4;
            border-radius: 10px;
            font-size: 13px;
            font-family: inherit;
            background: #faf9f7;
            color: #3a3a3a;
            outline: none;
        }

        .dday-form button {
            width: 100%;
            height: 46px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            font-weight: 500;
            color: #3a3a3a;
            transition: opacity 0.2s;
        }

        .dday-form button:hover { opacity: 0.85; }

        .dday-display-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .dday-display-area.hidden { display: none; }

        .dday-empty-hint {
            font-size: 15px;
            color: #bbb;
            font-weight: 500;
            padding: 10px 0;
        }

        .dday-name-display {
            font-size: 16px;
            font-weight: 700;
            color: #3a3a3a;
            margin-bottom: 2px;
        }

        .dday-display {
            font-size: 52px;
            font-weight: 600;
            color: #3a3a3a;
            line-height: 1.2;
        }

        .dday-date-text {
            font-size: 13px;
            color: #3a3a3a;
            font-weight: 600;
            margin-top: 6px;
        }

        /* 진행률 */
        .progress-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .circular-progress {
            width: 140px;
            height: 140px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circular-progress svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform: rotate(-90deg);
        }

        .progress-text {
            font-size: 28px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .progress-info {
            display: flex;
            gap: 32px;
        }
        
        .progress-info > div {
            text-align: center;
        }

        .progress-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 4px;
        }

        .progress-value {
            font-size: 24px;
            font-weight: 600;
        }

        /* 평가 */
        .evaluation-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        .rating-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .rating-star {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-star:hover { transform: scale(1.1); }

        .rating-star.filled {
            border-color: var(--theme, #b8d4e8);
        }

        .memo-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1.5px solid #ece9e4;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            background: #faf9f7;
        }

        /* ============= CALENDAR 페이지 스타일 ============= */
        .calendar-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        /* 날짜 메모 팝업 */
        .date-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 200;
            width: 90%;
            max-width: 350px;
        }

        .date-popup.open { display: block; }

        .date-popup-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .date-popup-colors {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .date-popup-color {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .date-popup-color:hover {
            transform: scale(1.1);
        }

        .date-popup-color.selected {
            border-color: #3a3a3a;
            transform: scale(1.15);
        }

        .date-popup-memo {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1.5px solid #ece9e4;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            background: #faf9f7;
            margin-bottom: 16px;
        }

        .date-popup-buttons {
            display: flex;
            gap: 8px;
        }

        .date-popup-buttons button {
            flex: 1;
            padding: 12px;
            font-size: 14px;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 199;
        }

        .popup-overlay.open { display: block; }

        .dday-card-calendar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 24px;
            width: 100%;
        }

        .dday-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dday-name-cal {
            font-size: 13px;
            color: #aaa;
            font-weight: 500;
        }

        .dday-name-cal.has-name {
            color: #3a3a3a;
            font-weight: 600;
        }

        .dday-number {
            font-size: 40px;
            font-weight: 300;
            color: #3a3a3a;
            line-height: 1;
        }

        .month-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .month-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 4px 12px;
            color: #3a3a3a;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .month-btn:hover { background-color: #f0ede8; }

        .month-title {
            font-size: 18px;
            font-weight: 600;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .weekday {
            text-align: center;
            font-size: 14px;
            font-weight: 700;
            color: #3a3a3a;
            padding: 8px 0;
        }

        .weekday.sun { color: #e05a7a; }
        .weekday.sat { color: #4a9bc5; }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            padding: 8px 6px 6px 6px;
            position: relative;
        }

        .day-cell:hover { background-color: #f8f8f8; }
        .day-cell.empty { cursor: default; }
        .day-cell.selected {
            background-color: #e8e8e8;
            outline: 2px solid #cccccc;
        }

        .day-num {
            font-size: 13px;
            font-weight: 600;
            line-height: 1;
            color: #3a3a3a;
            margin-bottom: 4px;
            position: relative;
            z-index: 2;
        }

        .day-cell.today .day-num {
            background-color: var(--theme, #b8d4e8);
            color: #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .day-cell.sunday .day-num { color: #e05a7a; }
        .day-cell.saturday .day-num { color: #4a9bc5; }
        .day-cell.today .day-num { color: #ffffff; }

        .grass-box {
            width: 55%;
            height: 6px;
            border-radius: 2px;
            background: transparent;
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
        }

        .day-cell.has-note::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            z-index: 1;
            opacity: 0.25;
            pointer-events: none;
        }

        .dday-label-cal {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: 700;
            color: #666;
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 4px;
            pointer-events: none;
            z-index: 2;
        }

        .holiday-label {
            position: absolute;
            bottom: 18px;
            left: 0;
            right: 0;
            font-size: 8px;
            font-weight: 600;
            color: #e05a7a;
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 2px;
            pointer-events: none;
            z-index: 2;
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: flex-end;
            padding-top: 12px;
            border-top: 1px solid #ece9e4;
        }

        .legend-label {
            font-size: 12px;
            color: #3a3a3a;
            font-weight: 600;
        }

        .legend-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .total-study-cal {
            margin-top: 16px;
            padding-top: 14px;
            border-top: 1px solid #ece9e4;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .total-study-label-cal {
            font-size: 13px;
            color: #3a3a3a;
            font-weight: 600;
        }

        .total-study-value-cal {
            font-size: 22px;
            font-weight: 700;
            color: #3a3a3a;
        }

        .total-study-unit {
            font-size: 13px;
            color: #3a3a3a;
            font-weight: 600;
            margin-left: 4px;
        }

        /* ============= FOCUS 페이지 스타일 ============= */
        .focus-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            gap: 30px;
        }

        .time-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 12px 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            text-align: center;
        }

        .current-time {
            font-size: 20px;
            color: #3a3a3a;
            font-weight: 600;
        }

        .task-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px 32px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            text-align: center;
        }

        .task-name {
            font-size: 24px;
            font-weight: 600;
            color: #3a3a3a;
        }

        .timer-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px 60px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            text-align: center;
            min-width: 500px;
        }

        .main-timer {
            font-size: 90px;
            font-weight: 600;
            letter-spacing: -3px;
            font-variant-numeric: tabular-nums;
            color: #3a3a3a;
            margin-bottom: 20px;
        }

        .total-time-section {
            padding-top: 20px;
            border-top: 1px solid #ece9e4;
        }

        .total-time-label {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 8px;
        }

        .total-time {
            font-size: 28px;
            font-weight: 600;
            color: #3a3a3a;
            font-variant-numeric: tabular-nums;
        }

        .button-container {
            display: flex;
            gap: 12px;
        }

        button {
            padding: 16px 40px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        button:hover { opacity: 0.85; }
        button:active { transform: scale(0.98); }

        .primary-button {
            background-color: #b8d4e8;
            color: #3a3a3a;
        }

        .secondary-button {
            background-color: #ece9e4;
            color: #3a3a3a;
        }

        .danger-button {
            background-color: #f4a7b9;
            color: #3a3a3a;
        }

        .edit-time-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 13px;
            cursor: pointer;
            padding: 8px 16px;
            font-family: inherit;
            transition: color 0.2s;
        }

        .edit-time-btn:hover {
            color: #666;
        }

        .edit-time-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 200;
            width: 90%;
            max-width: 350px;
        }

        .edit-time-popup.open { display: block; }

        .edit-time-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        .edit-time-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }

        .edit-time-info span {
            font-size: 20px;
            font-weight: 600;
            color: #3a3a3a;
            display: block;
            margin-top: 8px;
        }

        .edit-time-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            justify-content: center;
        }

        .time-adjust-btn {
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            border: 1.5px solid #ece9e4;
            background-color: #faf9f7;
            color: #3a3a3a;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            border-radius: 8px;
        }

        .time-adjust-btn:hover {
            background-color: #ece9e4;
        }

        .time-adjust-btn:active {
            transform: scale(0.95);
        }

        .edit-time-result {
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            color: #666;
        }

        .edit-time-result span {
            font-size: 24px;
            font-weight: 600;
            color: var(--theme, #b8d4e8);
            display: block;
            margin-top: 8px;
        }

        .edit-time-buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        .edit-time-buttons button {
            flex: 1;
            padding: 12px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .main { flex-direction: column; }
            .timer-card {
                min-width: auto;
                width: 100%;
                padding: 40px 30px;
            }
            .main-timer { font-size: 60px; }
            .total-time { font-size: 24px; }
            .button-container { flex-direction: column; width: 100%; }
            button { width: 100%; }
        }
    </style>
</head>
<body>

    <!-- 설정 패널 -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-title">설정</div>
            <div class="settings-label">테마 색상</div>
            <div class="color-presets">
                <div class="color-preset selected" data-color="#b8d4e8" style="background:#b8d4e8;"></div>
                <div class="color-preset" data-color="#f4a7b9" style="background:#f4a7b9;"></div>
                <div class="color-preset" data-color="#b5e0ba" style="background:#b5e0ba;"></div>
                <div class="color-preset" data-color="#d4b8e8" style="background:#d4b8e8;"></div>
                <div class="color-preset" data-color="#f9d49b" style="background:#f9d49b;"></div>
                <div class="color-preset" data-color="#f4b8a0" style="background:#f4b8a0;"></div>
                <div class="color-preset" data-color="#a8d8d8" style="background:#a8d8d8;"></div>
                <div class="color-preset" data-color="#c8c8c8" style="background:#c8c8c8;"></div>
            </div>
            <div class="custom-color-row">
                <label>직접 선택</label>
                <input type="color" id="customColor" value="#b8d4e8">
            </div>
        </div>
    </div>

    <!-- PLAN 페이지 -->
    <div id="planPage" class="page active">
        <div class="navbar">
            <div class="navbar-left">
                <div class="navbar-title">계획</div>
                <span class="nav-link" onclick="showPage('calendar')">달력</span>
            </div>
            <div class="hamburger" id="hamburger">
                <span></span><span></span><span></span>
            </div>
        </div>

        <div class="main">
            <div class="card" style="flex: 1;">
                <div class="date-header" id="dateHeader"></div>
                <div class="plan-list" id="planList">
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                    <div class="plan-slot">
                        <input type="checkbox" class="plan-checkbox">
                        <input type="text" class="slot-input" placeholder="">
                        <div class="plan-time">0:00</div>
                    </div>
                </div>
                <div class="total-study-time">
                    <span class="total-study-label">오늘 총 공부 시간</span>
                    <span class="total-study-value" id="todayTotalTime">00:00:00</span>
                </div>
            </div>

            <div class="right-section">
                <div class="card dday-card" id="ddayCard">
                    <div class="dday-display-area" id="ddayDisplayArea">
                        <div class="dday-empty-hint" id="ddayEmptyHint">+ D-day 설정</div>
                        <div class="dday-name-display" id="ddayName" style="display:none;"></div>
                        <div class="dday-display" id="ddayDisplay" style="display:none;"></div>
                        <div class="dday-date-text" id="ddayDateText" style="display:none;"></div>
                    </div>
                    <div class="dday-form" id="ddayForm">
                        <div class="dday-form-row">
                            <input type="text" id="ddayNameInput" placeholder="이름">
                            <input type="date" id="ddayInput">
                        </div>
                        <button id="setDdayBtn">설정</button>
                    </div>
                </div>

                <div class="card progress-card">
                    <div class="circular-progress">
                        <svg viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ece9e4" stroke-width="10"/>
                            <circle id="progressCircle" cx="50" cy="50" r="40" fill="none"
                                stroke="#b8d4e8" stroke-width="10"
                                stroke-dasharray="251.2" stroke-dashoffset="251.2"
                                stroke-linecap="round"/>
                        </svg>
                        <span class="progress-text" id="progressPercent">0%</span>
                    </div>
                    <div class="progress-info">
                        <div>
                            <div class="progress-label">계획 수</div>
                            <div class="progress-value" id="totalPlans">0</div>
                        </div>
                        <div>
                            <div class="progress-label">완료 수</div>
                            <div class="progress-value" id="completedPlans">0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="evaluation-title">오늘 하루 평가</div>
                    <div class="rating-container">
                        <div class="rating-star" data-rating="1"></div>
                        <div class="rating-star" data-rating="2"></div>
                        <div class="rating-star" data-rating="3"></div>
                        <div class="rating-star" data-rating="4"></div>
                        <div class="rating-star" data-rating="5"></div>
                    </div>
                    <textarea class="memo-input" id="memoInput" placeholder="오늘의 메모"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- CALENDAR 페이지 -->
    <div id="calendarPage" class="page">
        <div class="navbar">
            <div class="navbar-left">
                <span class="nav-link" onclick="showPage('plan')">계획</span>
                <div class="navbar-title">달력</div>
            </div>
            <div class="hamburger" onclick="toggleSettings()">
                <span></span><span></span><span></span>
            </div>
        </div>

        <!-- 날짜 메모 팝업 -->
        <div class="popup-overlay" id="datePopupOverlay"></div>
        <div class="date-popup" id="datePopup">
            <div class="date-popup-title" id="datePopupTitle">날짜 설정</div>
            <div class="date-popup-colors">
                <div class="date-popup-color" data-color="" style="background:#ece9e4;" title="색상 없음"></div>
                <div class="date-popup-color" data-color="#b8d4e8" style="background:#b8d4e8;"></div>
                <div class="date-popup-color" data-color="#f4a7b9" style="background:#f4a7b9;"></div>
                <div class="date-popup-color" data-color="#b5e0ba" style="background:#b5e0ba;"></div>
                <div class="date-popup-color" data-color="#f9d49b" style="background:#f9d49b;"></div>
            </div>
            <div style="margin: 10px 0; display: flex; align-items: center; gap: 8px;">
                <label style="font-size: 13px; color: #666;">자유색:</label>
                <input type="color" id="dateCustomColor" style="width: 40px; height: 30px; border: 1px solid #ece9e4; border-radius: 4px; cursor: pointer;">
            </div>
            <textarea class="date-popup-memo" id="datePopupMemo" placeholder="메모 (선택)"></textarea>
            <div class="date-popup-buttons">
                <button class="secondary-button" onclick="closeDatePopup()">취소</button>
                <button class="primary-button" onclick="saveDatePopup()">저장</button>
            </div>
        </div>

        <div class="calendar-main">
            <div class="card dday-card-calendar" id="ddayCardCal">
                <div class="dday-left">
                    <div class="dday-name-cal" id="ddayCardName">D-day 미설정</div>
                    <div class="dday-number" id="ddayCardNumber"></div>
                </div>
            </div>

            <div class="card" style="width: 100%;">
                <div class="month-nav">
                    <button class="month-btn" id="prevMonth">‹</button>
                    <div class="month-title" id="monthTitle"></div>
                    <button class="month-btn" id="nextMonth">›</button>
                </div>
                <div class="weekdays">
                    <div class="weekday sun">일</div>
                    <div class="weekday">월</div>
                    <div class="weekday">화</div>
                    <div class="weekday">수</div>
                    <div class="weekday">목</div>
                    <div class="weekday">금</div>
                    <div class="weekday sat">토</div>
                </div>
                <div class="days-grid" id="daysGrid"></div>
                <div class="legend">
                    <span class="legend-label">낮음</span>
                    <div class="legend-box" style="background:#ece9e4;"></div>
                    <div class="legend-box" id="legend1"></div>
                    <div class="legend-box" id="legend2"></div>
                    <div class="legend-box" id="legend3"></div>
                    <div class="legend-box" id="legend4"></div>
                    <span class="legend-label">높음</span>
                </div>
                <div class="total-study-cal">
                    <span class="total-study-label-cal">이번 달 총 공부 시간</span>
                    <div>
                        <span class="total-study-value-cal" id="totalHours">0</span>
                        <span class="total-study-unit">시간</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOCUS 페이지 -->
    <div id="focusPage" class="page">
        <div class="navbar">
            <div class="navbar-left">
                <span class="nav-link" onclick="goBackFromFocus()">← 계획</span>
                <div class="navbar-title">집중모드</div>
            </div>
            <div class="hamburger" onclick="toggleSettings()">
                <span></span><span></span><span></span>
            </div>
        </div>

        <div class="focus-main">
            <div class="time-card">
                <div class="current-time" id="currentTime">AM 00:00</div>
            </div>

            <div class="task-card">
                <div class="task-name" id="taskName">계획</div>
            </div>

            <div class="timer-card">
                <div class="main-timer" id="mainTimer">00:00:00</div>
            </div>

            <div class="button-container">
                <button class="primary-button" id="startStopBtn">시작</button>
                <button class="secondary-button" id="backBtn">목록으로</button>
                <button class="danger-button" id="completeBtn">완료</button>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="edit-time-btn" id="editTimeBtn">시간 수정하기</button>
            </div>
        </div>
    </div>

    <!-- 시간 수정 팝업 -->
    <div class="popup-overlay" id="editTimeOverlay"></div>
    <div class="edit-time-popup" id="editTimePopup">
        <div class="edit-time-title">시간 수정</div>
        <div class="edit-time-info">
            <div>현재 기록: <span id="currentTimeDisplay">00:00:00</span></div>
        </div>
        <div class="edit-time-input-row">
            <button class="time-adjust-btn" onclick="adjustTime(-10)">-10분</button>
            <button class="time-adjust-btn" onclick="adjustTime(-5)">-5분</button>
            <button class="time-adjust-btn" onclick="adjustTime(-1)">-1분</button>
        </div>
        <div class="edit-time-input-row">
            <input type="number" id="customMinutes" placeholder="분 입력" style="width: 100px; padding: 8px; text-align: center;">
            <button class="time-adjust-btn" onclick="adjustTimeCustom()">적용</button>
        </div>
        <div class="edit-time-input-row">
            <button class="time-adjust-btn" onclick="adjustTime(1)">+1분</button>
            <button class="time-adjust-btn" onclick="adjustTime(5)">+5분</button>
            <button class="time-adjust-btn" onclick="adjustTime(10)">+10분</button>
        </div>
        <div class="edit-time-result">
            수정 후: <span id="adjustedTimeDisplay">00:00:00</span>
        </div>
        <div class="edit-time-buttons">
            <button class="secondary-button" onclick="closeEditTimePopup()">취소</button>
            <button class="primary-button" onclick="saveAdjustedTime()">저장</button>
        </div>
    </div>

    <script>
        // ============= 전역 변수 =============
        let themeColor = '#b8d4e8';
        let currentPage = 'plan';
        let currentDate = new Date().toISOString().split('T')[0]; // 현재 보고 있는 날짜
        let todayDate = new Date().toISOString().split('T')[0]; // 오늘 날짜 (고정)

        // 날짜 체크 및 자동 업데이트
        function checkAndUpdateDate() {
            const newToday = new Date().toISOString().split('T')[0];
            if (newToday !== todayDate) {
                todayDate = newToday;
                currentDate = newToday;
                
                // 계획 페이지에 있으면 새로고침
                if (currentPage === 'plan') {
                    updatePlanPage();
                }
                
                // 달력 페이지에 있으면 새로고침
                if (currentPage === 'calendar') {
                    updateCalendarPage();
                }
                
                return true; // 날짜가 변경됨
            }
            return false; // 날짜 변경 없음
        }

        // 1분마다 날짜 체크
        setInterval(checkAndUpdateDate, 60000);

        // 페이지 포커스 돌아올 때 날짜 체크 (앱이 백그라운드에서 돌아올 때)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                checkAndUpdateDate();
            }
        });

        // 페이지 포커스 받을 때도 체크
        window.addEventListener('focus', () => {
            checkAndUpdateDate();
        });

        // 한국 공휴일 (2025-2030년) - 공식 출처 기반
        // 출처: 우주항공청, 한국천문연구원, 관공서의 공휴일에 관한 규정
        const holidays = {
            // 2025년
            '2025-01-01': '신정',
            '2025-01-28': '설날',
            '2025-01-29': '설날',
            '2025-01-30': '설날',
            '2025-03-01': '삼일절',
            '2025-03-03': '대체공휴일',
            '2025-05-05': '어린이날',
            '2025-05-25': '부처님오신날',
            '2025-06-06': '현충일',
            '2025-08-15': '광복절',
            '2025-10-03': '개천절',
            '2025-10-05': '추석',
            '2025-10-06': '추석',
            '2025-10-07': '추석',
            '2025-10-08': '대체공휴일',
            '2025-10-09': '한글날',
            '2025-12-25': '크리스마스',
            
            // 2026년 - 우주항공청 공식
            '2026-01-01': '신정',
            '2026-02-16': '설날',
            '2026-02-17': '설날',
            '2026-02-18': '설날',
            '2026-03-01': '삼일절',
            '2026-03-02': '대체공휴일',
            '2026-05-05': '어린이날',
            '2026-05-24': '부처님오신날',
            '2026-05-25': '대체공휴일',
            '2026-06-06': '현충일',
            '2026-08-15': '광복절',
            '2026-08-17': '대체공휴일',
            '2026-09-24': '추석',
            '2026-09-25': '추석',
            '2026-09-26': '추석',
            '2026-10-03': '개천절',
            '2026-10-05': '대체공휴일',
            '2026-10-09': '한글날',
            '2026-12-25': '크리스마스',
            
            // 2027년
            '2027-01-01': '신정',
            '2027-02-06': '설날',
            '2027-02-07': '설날',
            '2027-02-08': '설날',
            '2027-02-09': '대체공휴일',
            '2027-03-01': '삼일절',
            '2027-05-05': '어린이날',
            '2027-05-13': '부처님오신날',
            '2027-06-06': '현충일',
            '2027-08-15': '광복절',
            '2027-08-16': '대체공휴일',
            '2027-09-14': '추석',
            '2027-09-15': '추석',
            '2027-09-16': '추석',
            '2027-10-03': '개천절',
            '2027-10-04': '대체공휴일',
            '2027-10-09': '한글날',
            '2027-12-25': '크리스마스',
            '2027-12-27': '대체공휴일',
            
            // 2028년
            '2028-01-01': '신정',
            '2028-01-26': '설날',
            '2028-01-27': '설날',
            '2028-01-28': '설날',
            '2028-03-01': '삼일절',
            '2028-05-02': '부처님오신날',
            '2028-05-05': '어린이날',
            '2028-06-06': '현충일',
            '2028-08-15': '광복절',
            '2028-10-02': '추석',
            '2028-10-03': '추석',
            '2028-10-04': '추석',
            '2028-10-09': '한글날',
            '2028-12-25': '크리스마스',
            
            // 2029년
            '2029-01-01': '신정',
            '2029-02-12': '설날',
            '2029-02-13': '설날',
            '2029-02-14': '설날',
            '2029-03-01': '삼일절',
            '2029-05-05': '어린이날',
            '2029-05-07': '대체공휴일',
            '2029-05-20': '부처님오신날',
            '2029-05-21': '대체공휴일',
            '2029-06-06': '현충일',
            '2029-08-15': '광복절',
            '2029-09-21': '추석',
            '2029-09-22': '추석',
            '2029-09-23': '추석',
            '2029-09-24': '대체공휴일',
            '2029-10-03': '개천절',
            '2029-10-09': '한글날',
            '2029-12-25': '크리스마스',
            
            // 2030년
            '2030-01-01': '신정',
            '2030-02-02': '설날',
            '2030-02-03': '설날',
            '2030-02-04': '설날',
            '2030-02-05': '대체공휴일',
            '2030-03-01': '삼일절',
            '2030-05-05': '어린이날',
            '2030-05-06': '대체공휴일',
            '2030-05-09': '부처님오신날',
            '2030-06-06': '현충일',
            '2030-08-15': '광복절',
            '2030-09-11': '추석',
            '2030-09-12': '추석',
            '2030-09-13': '추석',
            '2030-10-03': '개천절',
            '2030-10-09': '한글날',
            '2030-12-25': '크리스마스'
        };

        // 공휴일 확인 함수
        function isHoliday(dateKey) {
            return holidays[dateKey] || null;
        }

        // ============= 페이지 전환 =============
        function showPage(pageName) {
            // 페이지 전환 전에 날짜 체크
            checkAndUpdateDate();
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageName + 'Page').classList.add('active');
            currentPage = pageName;

            if (pageName === 'plan') {
                updatePlanPage();
            } else if (pageName === 'calendar') {
                updateCalendarPage();
            } else if (pageName === 'focus') {
                updateFocusPage();
            }
        }

        function updatePlanPage() {
            updateDate();
            loadPlans();
            loadTodayTotalTime();
            updateProgress();
            updatePlanTimeBtns();
            loadDday();
            loadRatingAndMemo(); // 평가와 메모 로드
        }

        function updateCalendarPage() {
            renderCalendar();
            loadDdayCalendar();
        }

        function updateFocusPage() {
            initFocusMode();
        }

        // ============= 설정 패널 =============
        function toggleSettings() {
            document.getElementById('settingsOverlay').classList.toggle('open');
            document.getElementById('settingsPanel').classList.toggle('open');
        }

        document.getElementById('hamburger').addEventListener('click', toggleSettings);

        document.getElementById('settingsOverlay').addEventListener('click', e => {
            if (e.target === document.getElementById('settingsOverlay')) {
                toggleSettings();
            }
        });

        // 색상 적용
        function applyColor(color) {
            themeColor = color;
            document.documentElement.style.setProperty('--theme', color);
            document.querySelectorAll('.color-preset').forEach(p => {
                p.classList.toggle('selected', p.dataset.color === color);
            });

            document.getElementById('setDdayBtn').style.backgroundColor = color;
            document.getElementById('progressCircle').style.stroke = color;
            
            document.querySelectorAll('.plan-checkbox:checked').forEach(cb => {
                cb.style.backgroundColor = color;
                cb.style.borderColor = color;
            });

            updateStars();
            
            // localStorage에 테마 색상 저장
            localStorage.setItem('themeColor', color);
        }

        // 저장된 테마 색상 로드
        function loadThemeColor() {
            const savedColor = localStorage.getItem('themeColor');
            if (savedColor) {
                applyColor(savedColor);
                document.getElementById('customColor').value = savedColor;
            }
        }

        document.querySelectorAll('.color-preset').forEach(preset => {
            preset.addEventListener('click', function() {
                applyColor(this.dataset.color);
                document.getElementById('customColor').value = this.dataset.color;
            });
        });

        document.getElementById('customColor').addEventListener('input', function() {
            document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('selected'));
            applyColor(this.value);
        });

        // ============= PLAN 페이지 로직 =============
        function updateDate() {
            const date = new Date(currentDate);
            const days = ['일','월','화','수','목','금','토'];
            const y = String(date.getFullYear()).slice(2); // 24, 25, 26...
            const m = String(date.getMonth()+1).padStart(2,'0');
            const d = String(date.getDate()).padStart(2,'0');
            
            document.getElementById('dateHeader').innerHTML = `
                <span style="cursor:pointer; padding:4px 8px; border-radius:6px; transition:background 0.2s;" 
                      onclick="changeDate(-1)" 
                      onmouseover="this.style.background='#f0ede8'" 
                      onmouseout="this.style.background='transparent'">←</span>
                <span style="flex:1; text-align:center;">${y}.${m}.${d}(${days[date.getDay()]})</span>
                <span style="cursor:pointer; padding:4px 8px; border-radius:6px; transition:background 0.2s;" 
                      onclick="changeDate(1)" 
                      onmouseover="this.style.background='#f0ede8'" 
                      onmouseout="this.style.background='transparent'">→</span>
            `;
        }
        
        function changeDate(days) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + days);
            currentDate = date.toISOString().split('T')[0];
            updatePlanPage();
        }

        function savePlans() {
            const plans = [];
            document.querySelectorAll('.plan-slot').forEach(slot => {
                const input = slot.querySelector('.slot-input');
                const checkbox = slot.querySelector('.plan-checkbox');
                plans.push({
                    text: input.value,
                    checked: checkbox.checked
                });
            });
            
            // 날짜별로 저장
            const plansByDate = JSON.parse(localStorage.getItem('plansByDate') || '{}');
            plansByDate[currentDate] = plans;
            localStorage.setItem('plansByDate', JSON.stringify(plansByDate));
        }

        function loadPlans() {
            const plansByDate = JSON.parse(localStorage.getItem('plansByDate') || '{}');
            const plans = plansByDate[currentDate] || [];
            const slots = document.querySelectorAll('.plan-slot');
            
            // 먼저 모든 슬롯 초기화
            slots.forEach(slot => {
                const input = slot.querySelector('.slot-input');
                const checkbox = slot.querySelector('.plan-checkbox');
                const timeBtn = slot.querySelector('.plan-time');
                
                input.value = '';
                checkbox.checked = false;
                checkbox.classList.remove('visible');
                timeBtn.classList.remove('visible');
                slot.classList.remove('completed');
                checkbox.style.backgroundColor = '';
                checkbox.style.borderColor = '';
            });
            
            plans.forEach((plan, index) => {
                if (slots[index]) {
                    const input = slots[index].querySelector('.slot-input');
                    const checkbox = slots[index].querySelector('.plan-checkbox');
                    
                    input.value = plan.text;
                    checkbox.checked = plan.checked;
                    
                    if (plan.text) {
                        checkbox.classList.add('visible');
                        slots[index].querySelector('.plan-time').classList.add('visible');
                    }
                    
                    if (plan.checked) {
                        slots[index].classList.add('completed');
                        checkbox.style.backgroundColor = themeColor;
                        checkbox.style.borderColor = themeColor;
                    }
                }
            });
            updateProgress();
        }

        function initSlot(slot, index) {
            const checkbox = slot.querySelector('.plan-checkbox');
            const input = slot.querySelector('.slot-input');
            const timeBtn = slot.querySelector('.plan-time');
            slot.dataset.slotIndex = index;

            input.addEventListener('input', function() {
                const hasText = this.value.trim() !== '';
                checkbox.classList.toggle('visible', hasText);
                timeBtn.classList.toggle('visible', hasText);
                if (!hasText && checkbox.checked) {
                    checkbox.checked = false;
                    checkbox.style.backgroundColor = '';
                    checkbox.style.borderColor = '';
                    slot.classList.remove('completed');
                }
                updateProgress();
                savePlans();
                updatePlanTimeBtns();
            });

            input.addEventListener('keypress', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const slots = Array.from(document.querySelectorAll('.slot-input'));
                    const idx = slots.indexOf(input);
                    const next = slots[idx + 1];
                    if (next) next.focus();
                }
            });

            checkbox.addEventListener('change', function() {
                if (input.value.trim() === '') return;
                slot.classList.toggle('completed', this.checked);
                if (this.checked) {
                    this.style.backgroundColor = themeColor;
                    this.style.borderColor = themeColor;
                } else {
                    this.style.backgroundColor = '';
                    this.style.borderColor = '';
                }
                updateProgress();
                savePlans();
            });

            timeBtn.addEventListener('click', () => {
                const planName = input.value.trim();
                if (!planName) return;
                
                if (checkbox.checked) {
                    alert('이미 완료한 계획입니다!');
                    return;
                }
                
                localStorage.setItem('currentPlan', planName);
                localStorage.setItem('currentSlotIndex', index);
                showPage('focus');
            });
        }

        function updatePlanTimeBtns() {
            const slotTimesByDate = JSON.parse(localStorage.getItem('slotTimesByDate') || '{}');
            const slotTimes = slotTimesByDate[currentDate] || {};
            
            document.querySelectorAll('.plan-slot').forEach((slot, index) => {
                const input = slot.querySelector('.slot-input');
                const timeBtn = slot.querySelector('.plan-time');
                const planName = input.value.trim();
                if (!planName) return;
                
                const secs = slotTimes[index] || 0;
                if (secs === 0) {
                    timeBtn.textContent = '0:00';
                } else {
                    const h = Math.floor(secs / 3600);
                    const m = Math.floor((secs % 3600) / 60);
                    timeBtn.textContent = h > 0 ? `${h}:${String(m).padStart(2, '0')}` : `0:${String(m).padStart(2, '0')}`;
                }
            });
        }

        document.querySelectorAll('.plan-slot').forEach((slot, index) => initSlot(slot, index));

        function updateProgress() {
            const allSlots = document.querySelectorAll('.plan-slot');
            let total = 0, completed = 0;
            allSlots.forEach(slot => {
                const hasText = slot.querySelector('.slot-input').value.trim() !== '';
                if (hasText) {
                    total++;
                    if (slot.querySelector('.plan-checkbox').checked) completed++;
                }
            });
            const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
            document.getElementById('totalPlans').textContent = total;
            document.getElementById('completedPlans').textContent = completed;
            document.getElementById('progressPercent').textContent = percent + '%';
            const circle = document.getElementById('progressCircle');
            if (circle) circle.style.strokeDashoffset = 251.2 - (percent / 100) * 251.2;
        }

        function loadTodayTotalTime() {
            const savedTimes = JSON.parse(localStorage.getItem('studyTimes') || '{}');
            const todaySeconds = savedTimes[currentDate] || 0;
            
            const hours = Math.floor(todaySeconds / 3600);
            const mins = Math.floor((todaySeconds % 3600) / 60);
            const secs = todaySeconds % 60;
            
            document.getElementById('todayTotalTime').textContent = 
                `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // D-day
        function showDdayForm() {
            document.getElementById('ddayDisplayArea').classList.add('hidden');
            document.getElementById('ddayForm').classList.add('visible');
            document.getElementById('ddayCard').style.cursor = 'default';
            
            // 기존 값 불러오기
            const savedDate = localStorage.getItem('ddayDate');
            const savedName = localStorage.getItem('ddayName');
            if (savedDate) {
                document.getElementById('ddayInput').value = savedDate;
            }
            if (savedName) {
                document.getElementById('ddayNameInput').value = savedName;
            }
        }

        function showDdayResult(nameVal, diff, dateVal) {
            // 폼 숨기기
            document.getElementById('ddayForm').classList.remove('visible');
            
            // 결과 영역 보이기
            const area = document.getElementById('ddayDisplayArea');
            area.classList.remove('hidden');
            area.style.display = 'flex';
            document.getElementById('ddayCard').style.cursor = 'pointer';

            const hasData = diff !== null;
            document.getElementById('ddayEmptyHint').style.display = hasData ? 'none' : 'block';
            document.getElementById('ddayName').style.display = hasData ? 'block' : 'none';
            document.getElementById('ddayDisplay').style.display = hasData ? 'block' : 'none';
            document.getElementById('ddayDateText').style.display = hasData ? 'block' : 'none';

            if (hasData) {
                document.getElementById('ddayName').textContent = nameVal || '';
                document.getElementById('ddayDisplay').textContent =
                    diff > 0 ? `D-${diff}` : diff === 0 ? 'D-Day' : `D+${Math.abs(diff)}`;

                if (dateVal) {
                    const d = new Date(dateVal);
                    const formatted = `${d.getFullYear()}년 ${d.getMonth()+1}월 ${d.getDate()}일`;
                    document.getElementById('ddayDateText').textContent = formatted;
                }
            }
        }

        document.getElementById('ddayCard').addEventListener('click', function(e) {
            if (document.getElementById('ddayForm').classList.contains('visible')) return;
            showDdayForm();
        });

        document.getElementById('setDdayBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            const dateVal = document.getElementById('ddayInput').value;
            const nameVal = document.getElementById('ddayNameInput').value.trim();
            if (!dateVal) return;

            const target = new Date(dateVal);
            const today = new Date();
            today.setHours(0,0,0,0); target.setHours(0,0,0,0);
            const diff = Math.ceil((target - today) / 86400000);

            showDdayResult(nameVal, diff, dateVal);
            localStorage.setItem('ddayDate', dateVal);
            localStorage.setItem('ddayName', nameVal);
        });

        function loadDday() {
            const savedDate = localStorage.getItem('ddayDate');
            const savedName = localStorage.getItem('ddayName');
            
            if (!savedDate) {
                // D-day가 없으면 초기 상태 표시
                showDdayResult('', null, null);
                return;
            }

            document.getElementById('ddayInput').value = savedDate;
            document.getElementById('ddayNameInput').value = savedName || '';

            // currentDate 기준으로 D-day 계산
            const target = new Date(savedDate);
            const baseDate = new Date(currentDate);
            target.setHours(0,0,0,0); baseDate.setHours(0,0,0,0);
            const diff = Math.ceil((target - baseDate) / 86400000);

            showDdayResult(savedName || '', diff, savedDate);
        }

        // 평가
        const stars = document.querySelectorAll('.rating-star');
        let currentRating = 0;
        stars.forEach(star => {
            star.addEventListener('click', function() {
                currentRating = parseInt(this.dataset.rating);
                updateStars();
                saveRatingAndMemo(); // 평가 저장
            });
        });

        function updateStars() {
            stars.forEach((star, i) => {
                if (i < currentRating) {
                    star.classList.add('filled');
                    star.style.backgroundColor = themeColor;
                    star.style.borderColor = themeColor;
                } else {
                    star.classList.remove('filled');
                    star.style.backgroundColor = '';
                    star.style.borderColor = '#ddd';
                }
            });
        }

        // 메모 입력 시 저장
        document.getElementById('memoInput').addEventListener('input', function() {
            saveRatingAndMemo();
        });

        // 평가와 메모 저장
        function saveRatingAndMemo() {
            const ratingMemoData = JSON.parse(localStorage.getItem('ratingMemoData') || '{}');
            ratingMemoData[currentDate] = {
                rating: currentRating,
                memo: document.getElementById('memoInput').value
            };
            localStorage.setItem('ratingMemoData', JSON.stringify(ratingMemoData));
        }

        // 평가와 메모 불러오기
        function loadRatingAndMemo() {
            const ratingMemoData = JSON.parse(localStorage.getItem('ratingMemoData') || '{}');
            const data = ratingMemoData[currentDate] || { rating: 0, memo: '' };
            
            currentRating = data.rating;
            document.getElementById('memoInput').value = data.memo;
            updateStars();
        }

        // ============= CALENDAR 페이지 로직 =============
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1,3), 16);
            const g = parseInt(hex.slice(3,5), 16);
            const b = parseInt(hex.slice(5,7), 16);
            return { r, g, b };
        }

        function getGrassColor(level) {
            if (level === 0) return '#ece9e4';
            const { r, g, b } = hexToRgb(themeColor);
            const opacity = [0, 0.25, 0.45, 0.7, 1][level];
            return `rgba(${r}, ${g}, ${b}, ${opacity})`;
        }

        function loadStudyData() {
            const plansByDate = JSON.parse(localStorage.getItem('plansByDate') || '{}');
            const studyData = {};
            
            for (const [date, plans] of Object.entries(plansByDate)) {
                const totalPlans = plans.filter(p => p.text.trim() !== '').length;
                const checkedPlans = plans.filter(p => p.text.trim() !== '' && p.checked).length;
                const progress = totalPlans > 0 ? checkedPlans / totalPlans : 0;
                
                studyData[date] = {
                    progress: progress, // 0.0 ~ 1.0
                    checkedPlans: checkedPlans,
                    totalPlans: totalPlans
                };
            }
            
            return studyData;
        }

        function getGrassLevel(progress) {
            if (!progress || progress === 0) return 0;
            if (progress < 0.25) return 1; // 25% 미만
            if (progress < 0.5) return 2;  // 50% 미만
            if (progress < 0.75) return 3; // 75% 미만
            return 4; // 75% 이상
        }

        function updateLegend() {
            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById(`legend${i}`);
                if (el) el.style.background = getGrassColor(i);
            }
        }

        function renderCalendar() {
            const studyData = loadStudyData();
            const now = new Date();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();

            document.getElementById('monthTitle').textContent =
                `${currentYear}년 ${currentMonth + 1}월`;

            const grid = document.getElementById('daysGrid');
            grid.innerHTML = '';
            
            // 기존 동적 스타일 제거
            const oldStyles = document.querySelectorAll('style[data-calendar-notes]');
            oldStyles.forEach(s => s.remove());
            
            // 날짜 노트 색상을 위한 스타일 생성
            const dateNotes = JSON.parse(localStorage.getItem('dateNotes') || '{}');
            let noteStyles = '';
            for (const [dateKey, note] of Object.entries(dateNotes)) {
                if (note && note.color) {
                    noteStyles += `
                        .day-cell[data-date-key="${dateKey}"].has-note::after {
                            background-color: ${note.color} !important;
                        }
                    `;
                }
            }
            if (noteStyles) {
                const styleEl = document.createElement('style');
                styleEl.setAttribute('data-calendar-notes', 'true');
                styleEl.textContent = noteStyles;
                document.head.appendChild(styleEl);
            }

            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell empty';
                grid.appendChild(empty);
            }

            let monthTotalChecked = 0;
            let monthTotalPlans = 0;
            let monthTotalSeconds = 0; // 총 공부시간 (초)
            
            // studyTimes 한 번만 로드
            const savedTimes = JSON.parse(localStorage.getItem('studyTimes') || '{}');

            for (let d = 1; d <= lastDate; d++) {
                const dateKey = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const data = studyData[dateKey];
                const dow = new Date(currentYear, currentMonth, d).getDay();
                const grassLevel = getGrassLevel(data?.progress);
                if (data) {
                    monthTotalChecked += data.checkedPlans || 0;
                    monthTotalPlans += data.totalPlans || 0;
                }
                
                // studyTimes에서 시간 누적
                monthTotalSeconds += savedTimes[dateKey] || 0;

                const cell = document.createElement('div');
                cell.className = 'day-cell';
                cell.dataset.dateKey = dateKey;
                if (now.getFullYear() === currentYear && now.getMonth() === currentMonth && now.getDate() === d)
                    cell.classList.add('today');
                
                // 공휴일 또는 일요일이면 빨간색
                const holiday = isHoliday(dateKey);
                if (dow === 0 || holiday) {
                    cell.classList.add('sunday');
                } else if (dow === 6) {
                    // 공휴일이 아닌 토요일만 파란색
                    cell.classList.add('saturday');
                }

                const grassDiv = document.createElement('div');
                grassDiv.className = 'grass-box';
                grassDiv.style.background = getGrassColor(grassLevel);

                const numDiv = document.createElement('div');
                numDiv.className = 'day-num';
                numDiv.textContent = d;

                cell.appendChild(numDiv);
                cell.appendChild(grassDiv);

                // 공휴일 표시
                if (holiday) {
                    const holidayLabel = document.createElement('div');
                    holidayLabel.className = 'holiday-label';
                    holidayLabel.textContent = holiday;
                    cell.appendChild(holidayLabel);
                }

                const ddayDate = localStorage.getItem('ddayDate');
                const ddayName = localStorage.getItem('ddayName');
                const isDday = ddayDate === dateKey;
                
                // 날짜 노트 색상 표시
                const note = dateNotes[dateKey];
                if (note && note.color) {
                    cell.classList.add('has-note');
                }
                
                // 텍스트 표시: D-day 우선, 없으면 메모
                if (isDday && ddayName) {
                    const ddayLabel = document.createElement('div');
                    ddayLabel.className = 'dday-label-cal';
                    ddayLabel.textContent = ddayName;
                    cell.appendChild(ddayLabel);
                } else if (note && note.memo) {
                    const noteLabel = document.createElement('div');
                    noteLabel.className = 'dday-label-cal';
                    noteLabel.textContent = note.memo;
                    cell.appendChild(noteLabel);
                }

                // 싱글 클릭으로 메모/색상 설정
                let clickTimer = null;
                cell.addEventListener('click', (e) => {
                    if (clickTimer) {
                        // 더블클릭
                        clearTimeout(clickTimer);
                        clickTimer = null;
                    } else {
                        // 싱글클릭
                        clickTimer = setTimeout(() => {
                            clickTimer = null;
                            openDatePopup(dateKey);
                        }, 250);
                    }
                });

                // 더블클릭으로 해당 날짜의 계획 페이지로 이동
                cell.addEventListener('dblclick', (e) => {
                    currentDate = dateKey;
                    showPage('plan');
                });

                grid.appendChild(cell);
            }

            const monthTotalHours = (monthTotalSeconds / 3600).toFixed(1);
            document.getElementById('totalHours').textContent = monthTotalHours;
            updateLegend();
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // 날짜 메모/색상 팝업
        let selectedDateKey = null;

        function openDatePopup(dateKey) {
            selectedDateKey = dateKey;
            const date = new Date(dateKey);
            document.getElementById('datePopupTitle').textContent = 
                `${date.getMonth()+1}월 ${date.getDate()}일`;
            
            // 저장된 데이터 불러오기
            const dateNotes = JSON.parse(localStorage.getItem('dateNotes') || '{}');
            const note = dateNotes[dateKey] || { color: '', memo: '' };
            
            document.getElementById('datePopupMemo').value = note.memo || '';
            
            // 색상 선택 표시
            const isPresetColor = note.color === '' || ['#b8d4e8', '#f4a7b9', '#b5e0ba', '#f9d49b'].includes(note.color);
            document.querySelectorAll('.date-popup-color').forEach(c => {
                c.classList.toggle('selected', c.dataset.color === note.color);
            });
            
            // 자유색 입력란에 표시
            document.getElementById('dateCustomColor').value = note.color || '#b8d4e8';
            
            document.getElementById('datePopupOverlay').classList.add('open');
            document.getElementById('datePopup').classList.add('open');
        }

        function closeDatePopup() {
            document.getElementById('datePopupOverlay').classList.remove('open');
            document.getElementById('datePopup').classList.remove('open');
            selectedDateKey = null;
        }

        function saveDatePopup() {
            if (!selectedDateKey) return;
            
            const memo = document.getElementById('datePopupMemo').value.trim();
            const selectedColor = document.querySelector('.date-popup-color.selected');
            const customColor = document.getElementById('dateCustomColor').value;
            
            // 프리셋 색상이 선택되었으면 그걸 사용, 아니면 자유색 사용
            const color = selectedColor ? selectedColor.dataset.color : customColor;
            
            const dateNotes = JSON.parse(localStorage.getItem('dateNotes') || '{}');
            
            if (!memo && !color) {
                // 메모와 색상 둘 다 없으면 삭제
                delete dateNotes[selectedDateKey];
            } else {
                dateNotes[selectedDateKey] = { color, memo };
            }
            
            localStorage.setItem('dateNotes', JSON.stringify(dateNotes));
            closeDatePopup();
            renderCalendar();
        }

        // 팝업 색상 선택
        document.querySelectorAll('.date-popup-color').forEach(color => {
            color.addEventListener('click', function() {
                document.querySelectorAll('.date-popup-color').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // 자유색 선택 시 프리셋 선택 해제
        document.getElementById('dateCustomColor').addEventListener('input', function() {
            document.querySelectorAll('.date-popup-color').forEach(c => c.classList.remove('selected'));
        });

        document.getElementById('datePopupOverlay').addEventListener('click', closeDatePopup);

        function loadDdayCalendar() {
            const ddayDate = localStorage.getItem('ddayDate');
            const ddayName = localStorage.getItem('ddayName');

            const nameEl = document.getElementById('ddayCardName');
            const numberEl = document.getElementById('ddayCardNumber');

            if (!ddayDate) {
                nameEl.textContent = 'D-day가 설정되지 않았어요';
                nameEl.className = 'dday-name-cal';
                numberEl.textContent = '';
                return;
            }

            const target = new Date(ddayDate);
            const today = new Date();
            today.setHours(0,0,0,0);
            target.setHours(0,0,0,0);
            const diff = Math.ceil((target - today) / 86400000);

            nameEl.textContent = ddayName ? ddayName : '목표일';
            nameEl.className = 'dday-name-cal has-name';
            numberEl.textContent = diff > 0 ? `D-${diff}` : diff === 0 ? 'D-Day' : `D+${Math.abs(diff)}`;
        }

        // ============= FOCUS 페이지 로직 =============
        let isRunning = false;
        let mainMs = 0;
        let sessionMs = 0; // 이번 세션 밀리초
        let prevMs = 0; // 이전 누적 밀리초
        let mainInterval = null;
        let totalInterval = null;
        let startDate = null;
        let currentPlan = null;
        let currentSlotIndex = null;
        let timerStartTime = null; // 타이머 시작 시각

        function formatMainTimer(ms) {
            const totalSecs = Math.floor(ms / 1000);
            const hours = Math.floor(totalSecs / 3600);
            const mins = Math.floor((totalSecs % 3600) / 60);
            const secs = totalSecs % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function formatTotalTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            if (!isRunning || !timerStartTime) return;
            
            const now = Date.now();
            const elapsed = now - timerStartTime;
            
            mainMs = prevMs + elapsed;
            sessionMs = elapsed;
            
            document.getElementById('mainTimer').textContent = formatMainTimer(mainMs);
        }

        function startTimer() {
            isRunning = true;
            if (!startDate) startDate = new Date().toISOString().split('T')[0];
            
            // 타이머 시작 시각 기록
            timerStartTime = Date.now();

            document.getElementById('startStopBtn').textContent = '중단';
            document.getElementById('startStopBtn').style.backgroundColor = '#b8d4e8';
            document.getElementById('startStopBtn').style.color = '#3a3a3a';

            // 1초마다 업데이트
            mainInterval = setInterval(updateTimerDisplay, 1000);
            // 즉시 한 번 업데이트
            updateTimerDisplay();
        }

        function stopTimer() {
            isRunning = false;
            timerStartTime = null;
            
            document.getElementById('startStopBtn').textContent = '시작';
            document.getElementById('startStopBtn').style.backgroundColor = '#b8d4e8';
            document.getElementById('startStopBtn').style.color = '#3a3a3a';
            
            clearInterval(mainInterval);
            
            // 중단 시 현재까지 누적 (밀리초 단위)
            prevMs = prevMs + sessionMs;
            mainMs = prevMs;
            sessionMs = 0;
        }

        document.getElementById('startStopBtn').addEventListener('click', () => {
            // 오늘 날짜가 아니면 작동 안 함
            if (currentDate !== todayDate) {
                return;
            }
            if (isRunning) stopTimer();
            else startTimer();
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            if (isRunning) stopTimer();
            saveFinalTime();
            showPage('plan'); // currentDate 유지
        });

        function goBackFromFocus() {
            if (isRunning) stopTimer();
            saveFinalTime();
            showPage('plan'); // currentDate 유지
        }

        function saveFinalTime() {
            if (prevMs === 0) return;
            
            // startDate가 있으면 사용 (자정 넘김 대응), 없으면 currentDate 사용
            const saveDate = startDate || currentDate;
            const prevSeconds = Math.floor(prevMs / 1000); // 초 단위로 변환
            
            // 슬롯별 시간 저장 (초 단위)
            if (currentSlotIndex !== null) {
                const slotTimesByDate = JSON.parse(localStorage.getItem('slotTimesByDate') || '{}');
                const dateSlotTimes = slotTimesByDate[saveDate] || {};
                const oldTime = dateSlotTimes[currentSlotIndex] || 0;
                dateSlotTimes[currentSlotIndex] = prevSeconds;
                slotTimesByDate[saveDate] = dateSlotTimes;
                localStorage.setItem('slotTimesByDate', JSON.stringify(slotTimesByDate));
                
                // 총 공부시간 업데이트 (차이만큼만)
                const diff = prevSeconds - oldTime;
                const savedTimes = JSON.parse(localStorage.getItem('studyTimes') || '{}');
                savedTimes[saveDate] = (savedTimes[saveDate] || 0) + diff;
                localStorage.setItem('studyTimes', JSON.stringify(savedTimes));
            }
        }

        document.getElementById('completeBtn').addEventListener('click', () => {
            if (isRunning) stopTimer();
            saveFinalTime();
            
            if (currentSlotIndex !== null) {
                const plansByDate = JSON.parse(localStorage.getItem('plansByDate') || '{}');
                const datePlans = plansByDate[currentDate] || []; // currentDate 사용
                if (datePlans[currentSlotIndex]) {
                    datePlans[currentSlotIndex].checked = true;
                    plansByDate[currentDate] = datePlans; // currentDate에 저장
                    localStorage.setItem('plansByDate', JSON.stringify(plansByDate));
                }
            }
            
            showPage('plan');
        });

        function updateCurrentTime() {
            const now = new Date();
            let hours = now.getHours();
            const mins = now.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            document.getElementById('currentTime').textContent =
                `${ampm} ${hours}:${String(mins).padStart(2, '0')}`;
        }

        function initFocusMode() {
            isRunning = false;
            mainMs = 0;
            sessionMs = 0;
            prevMs = 0;
            clearInterval(mainInterval);
            clearInterval(totalInterval);
            startDate = null;
            timerStartTime = null;

            currentPlan = localStorage.getItem('currentPlan');
            currentSlotIndex = localStorage.getItem('currentSlotIndex');
            
            if (currentPlan) {
                document.getElementById('taskName').textContent = currentPlan;

                if (currentSlotIndex !== null) {
                    const slotTimesByDate = JSON.parse(localStorage.getItem('slotTimesByDate') || '{}');
                    const dateSlotTimes = slotTimesByDate[currentDate] || {}; // currentDate 사용
                    const savedSeconds = dateSlotTimes[currentSlotIndex] || 0;
                    prevMs = savedSeconds * 1000; // 초를 밀리초로 변환
                    if (prevMs > 0) {
                        mainMs = prevMs;
                        document.getElementById('mainTimer').textContent = formatMainTimer(mainMs);
                    } else {
                        document.getElementById('mainTimer').textContent = '00:00:00';
                    }
                }
            }

            updateCurrentTime();
            
            // 오늘 날짜가 아니면 시작/중단 버튼 비활성화
            const isToday = currentDate === todayDate;
            const startStopBtn = document.getElementById('startStopBtn');
            if (!isToday) {
                startStopBtn.disabled = true;
                startStopBtn.style.opacity = '0.3';
                startStopBtn.style.cursor = 'not-allowed';
                startStopBtn.title = '오늘 날짜에서만 타이머를 사용할 수 있습니다';
            } else {
                startStopBtn.disabled = false;
                startStopBtn.style.opacity = '1';
                startStopBtn.style.cursor = 'pointer';
                startStopBtn.title = '';
            }
        }

        // 시간 수정 팝업
        let tempAdjustedSeconds = 0;

        document.getElementById('editTimeBtn').addEventListener('click', () => {
            if (isRunning) {
                alert('타이머를 먼저 중단해주세요!');
                return;
            }
            
            const currentTotal = Math.floor(prevMs / 1000); // 밀리초를 초로
            tempAdjustedSeconds = currentTotal;
            
            document.getElementById('currentTimeDisplay').textContent = formatTotalTime(currentTotal);
            document.getElementById('adjustedTimeDisplay').textContent = formatTotalTime(tempAdjustedSeconds);
            
            document.getElementById('editTimeOverlay').classList.add('open');
            document.getElementById('editTimePopup').classList.add('open');
        });

        function closeEditTimePopup() {
            document.getElementById('editTimeOverlay').classList.remove('open');
            document.getElementById('editTimePopup').classList.remove('open');
            document.getElementById('customMinutes').value = '';
        }

        function adjustTime(minutes) {
            const currentTotal = Math.floor(prevMs / 1000);
            tempAdjustedSeconds = Math.max(0, currentTotal + (minutes * 60));
            document.getElementById('adjustedTimeDisplay').textContent = formatTotalTime(tempAdjustedSeconds);
        }

        function adjustTimeCustom() {
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (isNaN(minutes)) return;
            adjustTime(minutes);
        }

        function saveAdjustedTime() {
            const currentTotal = Math.floor(prevMs / 1000);
            const diff = tempAdjustedSeconds - currentTotal;
            
            // prevMs에 반영 (초를 밀리초로)
            prevMs = tempAdjustedSeconds * 1000;
            mainMs = prevMs;
            sessionMs = 0;
            
            // 화면 업데이트
            document.getElementById('mainTimer').textContent = formatMainTimer(mainMs);
            
            // localStorage 업데이트
            if (currentSlotIndex !== null) {
                // 시간 수정은 현재 보고 있는 날짜(currentDate)에 저장
                const saveDate = currentDate;
                const slotTimesByDate = JSON.parse(localStorage.getItem('slotTimesByDate') || '{}');
                const dateSlotTimes = slotTimesByDate[saveDate] || {};
                
                // 기존 슬롯 시간 가져오기
                const oldSlotTime = dateSlotTimes[currentSlotIndex] || 0;
                
                // 슬롯 시간 업데이트
                dateSlotTimes[currentSlotIndex] = tempAdjustedSeconds; // 초 단위로 저장
                slotTimesByDate[saveDate] = dateSlotTimes;
                localStorage.setItem('slotTimesByDate', JSON.stringify(slotTimesByDate));
                
                // studyTimes도 업데이트 (차이만큼 조정)
                const savedTimes = JSON.parse(localStorage.getItem('studyTimes') || '{}');
                const actualDiff = tempAdjustedSeconds - oldSlotTime;
                savedTimes[saveDate] = (savedTimes[saveDate] || 0) + actualDiff;
                localStorage.setItem('studyTimes', JSON.stringify(savedTimes));
            }
            
            closeEditTimePopup();
        }

        document.getElementById('editTimeOverlay').addEventListener('click', closeEditTimePopup);

        // ============= 초기화 =============
        loadThemeColor(); // 저장된 테마 색상 로드
        updateDate();
        loadPlans();
        loadTodayTotalTime();
        updateProgress();
        updatePlanTimeBtns();
        loadDday();
        loadRatingAndMemo(); // 평가와 메모 로드
        setInterval(updateCurrentTime, 60000);
        
        // 앱 로드 시 날짜 체크
        checkAndUpdateDate();
    </script>
</body>
</html>
